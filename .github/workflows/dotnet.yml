name: .NET MAUI Build

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build-windows-android:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x
    
    # Only install Android workloads for this runner
    - name: Install Android workload
      run: dotnet workload install android
    
    - name: Restore dependencies
      run: dotnet restore CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj
    
    # Build only Android framework
    - name: Build Android
      run: dotnet build CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj --framework net9.0-android --no-restore --configuration Release

  build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x
    
    # Install Windows workload
    - name: Install Windows workload
      run: dotnet workload install maccatalyst
    
    - name: Restore dependencies
      run: dotnet restore CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj
    
    # Build only Windows framework  
    - name: Build Windows
      run: dotnet build CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj --framework net9.0-windows10.0.19041.0 --no-restore --configuration Release

  build-ios-maccatalyst:
    runs-on: macos-14  # Use macOS 14 which has Xcode 16.x
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x
    
    # Install iOS/MacCatalyst workloads
    - name: Install iOS and MacCatalyst workloads
      run: |
        dotnet workload install ios
        dotnet workload install maccatalyst
    
    - name: Restore dependencies
      run: dotnet restore CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj
    
    # Build iOS framework
    - name: Build iOS
      run: dotnet build CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj --framework net9.0-ios --no-restore --configuration Release
    
    # Build MacCatalyst framework
    - name: Build MacCatalyst
      run: dotnet build CheapGlyphForge.MAUI/CheapGlyphForge.MAUI.csproj --framework net9.0-maccatalyst --no-restore --configuration Release

  # Optional: Core library build verification (cross-platform)
  build-core:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 9.0.x
    
    - name: Restore Core dependencies
      run: dotnet restore CheapGlyphForge.Core/CheapGlyphForge.Core.csproj
    
    - name: Build Core library
      run: dotnet build CheapGlyphForge.Core/CheapGlyphForge.Core.csproj --no-restore --configuration Release
    
    - name: Test Core library
      run: dotnet test CheapGlyphForge.Core/CheapGlyphForge.Core.csproj --no-build --configuration Release
